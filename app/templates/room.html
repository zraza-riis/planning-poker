{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1>You have joined room {{ room.name }}</h1>
    <h4>Invite your team members with the following link: {{ room.join_link }}</h4>
    <h5>Connected Users:</h5>
    <ul id="connectedPlayersList"></ul>

    <form id="promptForm">
        <input type="text" id="promptInput" placeholder="Enter your prompt" required>
        <button type="submit">Submit</button>
    </form>

    <script type="text/javascript">
        var socket = io.connect();
    
        socket.on('connect', function() {
            console.log('Connected to server');
            socket.emit('join_room', {'room_uuid': '{{ room.uuid }}'});
        });
    
        socket.on('disconnect', function() {
            console.log('Disconnected from server');
            socket.emit('leave_room', {'room_uuid': '{{ room.uuid }}'});
        });
    
        socket.on('new_room', function(data) {
            console.log('New room created:', data.room_uuid);
        });

        // Handle a new Prompt getting created
        socket.on('new_prompt', function(data) {
            console.log('New prompt submitted:', data.prompt_title);
        });

        socket.on('player_joined', function(data) {
            console.log('Player joined:', data.player_name);
            updateConnectedPlayersList(data.players);
        });

        socket.on('player_left', function(data) {
            console.log('Player left:', data.player_name);
            updateConnectedPlayersList(data.players);
        });

        document.getElementById('promptForm').addEventListener('submit', function(event) {
            event.preventDefault();

            var promptInput = document.getElementById('promptInput').value;

            socket.emit('new_prompt', {'room_uuid': '{{ room.uuid }}', 'prompt_title': promptInput});

            document.getElementById('promptInput').value = '';

        });

        function updateConnectedPlayersList(players) {
            var playersListElement = document.getElementById('connectedPlayersList');
            playersListElement.innerHTML = '';

            players.forEach(function(player) {
                var listItem = document.createElement('li');
                listItem.textContent = player;
                playersListElement.appendChild(listItem);
            });
        }

        
    </script>

</div>
{% endblock %}